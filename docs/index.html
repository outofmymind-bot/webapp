<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Игровое приложение</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 50px;
      background-image: url('https://a.d-cd.net/tEAAAgE2ZuA-1920.jpg');
      background-size: cover;
      background-position: center;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
    }
    #balance {
      margin-top: 20px;
      font-size: 24px;
      color: green;
    }
    #pigNameInput {
      font-size: 18px;
      margin-bottom: 20px;
    }
    #topPlayers {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Добро пожаловать в игру!</h1>
  
  <input type="text" id="pigNameInput" placeholder="Имя свинки">
  <div id="balance">Баланс: 0</div>

  <button id="hryukButton">Хрюкаем ежеминутно</button>
  <button id="topButton">Лучшие</button>
  <button id="upgradeButton">Прокачать</button>
  
  <div id="topPlayers">
    <h2>Топ 10 игроков:</h2>
    <ul id="topList"></ul>
  </div>

  <script>
    // Проверяем и инициализируем локальные данные
    let userId = "user123"; // Может быть динамическим
    let lastActionTime = localStorage.getItem('lastActionTime');
    let balance = parseInt(localStorage.getItem('balance')) || 0;
    let clickValue = parseInt(localStorage.getItem('clickValue')) || 1;
    let pigName = localStorage.getItem('pigName') || "";

    // Обновляем баланс при загрузке
    function updateBalanceDisplay() {
      document.getElementById('balance').innerText = "Баланс: " + balance;
    }

    // Вычисляем разницу во времени и увеличиваем баланс
    function applyOfflineEarnings() {
      if (lastActionTime) {
        let timeDifference = Date.now() - lastActionTime;
        let earnedPoints = Math.floor(timeDifference / 3000) * 50; // 50 монет каждые 3 секунды
        balance += earnedPoints;
        localStorage.setItem('balance', balance); // Сохраняем новый баланс
        localStorage.setItem('lastActionTime', Date.now()); // Обновляем время последнего действия
        updateBalanceDisplay();
      }
    }

    // Слушаем события нажатия
    document.body.addEventListener('click', function() {
      balance += clickValue; // Увеличиваем баланс на значение клика
      localStorage.setItem('balance', balance);
      localStorage.setItem('lastActionTime', Date.now()); // Обновляем время последнего действия
      updateBalanceDisplay();
    });

    // Обработчик клика по кнопке "Прокачать"
    document.getElementById('upgradeButton').addEventListener('click', function() {
      if (balance >= 100) {
        balance -= 100;
        clickValue = 2; // Увеличиваем значение клика
        localStorage.setItem('clickValue', clickValue); // Сохраняем новый clickValue
        localStorage.setItem('balance', balance);
        updateBalanceDisplay();
      } else {
        alert("Недостаточно средств для прокачки!");
      }
    });

    // Обработчик клика по кнопке "Хрюкаем ежеминутно"
    document.getElementById('hryukButton').addEventListener('click', function() {
      if (balance >= 10) {
        balance -= 10; // Уменьшаем на 10
        localStorage.setItem('balance', balance);
        updateBalanceDisplay();

        setInterval(function() {
          balance += 50; // Увеличиваем баланс на 50 каждые 3 секунды
          localStorage.setItem('balance', balance);
          updateBalanceDisplay();
        }, 3000); // Каждые 3 секунды
      } else {
        alert("Недостаточно средств для хрюканья!");
      }
    });

    // Обработчик клика по кнопке "Лучшие"
    document.getElementById('topButton').addEventListener('click', function() {
      let topList = document.getElementById('topList');
      topList.innerHTML = ''; // Очистить текущий список

      // Получаем данные из localStorage и отображаем топ 10
      let players = JSON.parse(localStorage.getItem('players')) || [];
      players.push({ name: pigName, balance: balance });
      players.sort((a, b) => b.balance - a.balance); // Сортировка по балансу

      // Ограничиваем количество игроков топ 10
      players.slice(0, 10).forEach(function(player) {
        let li = document.createElement('li');
        li.textContent = `${player.name}: ${player.balance} монет`;
        topList.appendChild(li);
      });

      // Сохраняем список игроков
      localStorage.setItem('players', JSON.stringify(players));

      // Показываем/скрываем список
      document.getElementById('topPlayers').style.display = document.getElementById('topPlayers').style.display === 'none' ? 'block' : 'none';
    });

    // Сохраняем имя свинки в localStorage
    document.getElementById('pigNameInput').addEventListener('change', function() {
      pigName = document.getElementById('pigNameInput').value;
      localStorage.setItem('pigName', pigName);
    });

    // Применяем заработанные монеты при отсутствии
    applyOfflineEarnings();

    // Отображаем текущий баланс
    updateBalanceDisplay();
  </script>

</body>
</html>
